<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="author" content="Ryan McGeary" />
<meta name="description" content="This post is in response to the 10gen MongoDB Schema Design Contest. It was also extracted from talks that I’ve given on the subject.BusyConf currently handles 4 major pieces of conference planning..." />
<meta name="og:title" content="MongoDB Schema Design at BusyConf" />
<meta name="og:description" content="This post is in response to the 10gen MongoDB Schema Design Contest. It was also extracted from talks that I’ve given on the subject.BusyConf currently handles 4 major pieces of conference planning..." />
<meta name="og:site_name" content="Ryan McGeary" />
<meta name="og:image" content="http://ryan.mcgeary.org/2012/06/05/mongodb-schema-design-at-busyconf/logical-model.png" />
<meta name="twitter:image" content="http://ryan.mcgeary.org/2012/06/05/mongodb-schema-design-at-busyconf/logical-model.png" />
<meta name="og:image" content="http://ryan.mcgeary.org/2012/06/05/mongodb-schema-design-at-busyconf/relational-model.png" />

<meta name="og:image" content="http://ryan.mcgeary.org/2012/06/05/mongodb-schema-design-at-busyconf/mongodb-option1.png" />

<meta name="og:image" content="http://ryan.mcgeary.org/2012/06/05/mongodb-schema-design-at-busyconf/mongodb-option2.png" />

<meta name="og:image" content="http://ryan.mcgeary.org/images/ryan.mcgeary.jpg" />

<meta name="twitter:site" content="@rmm5t" />
<meta name="twitter:creator" content="@rmm5t" />
<meta name="og:type" content="article" />
<meta name="article:published_time" content="2012-06-04T18:00:00-06:00" />
<meta name="article:tag" content="programming" />
<meta name="article:tag" content="business" />
<meta name="keywords" content="programming,business" />
<meta name="twitter:card" content="summary_large_image" />
<title>MongoDB Schema Design at BusyConf - Ryan McGeary</title>
<link rel="alternate" type="application/atom+xml" title="Ryan McGeary Blog Posts" href="http://feeds.feedburner.com/ryanmcgeary" />
<link type="image/x-icon" href="/favicon.ico" rel="icon" />
<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
<link href="/stylesheets/all.css" rel="stylesheet" type="text/css" />
<!--[if lt IE 9]>
<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv-printshiv.min.js" type="text/javascript"></script>
<![endif]-->
</head>
<body class='x2012 x2012_06 x2012_06_05 x2012_06_05_mongodb-schema-design-at-busyconf x2012_06_05_mongodb-schema-design-at-busyconf_index'>
<div id='background'></div>
<div id='photo'><img src="/images/ryan.mcgeary.png" /></div>
<header data-offset-top='15' data-spy='affix' id='masthead' role='banner'>
<p class='sr-only'><a rel="home" href="/">Ryan McGeary</a></p>
<div class='sm-controls'>
<a class="btn" data-toggle="class" data-target="#sidebar, #background, #photo, #masthead .logo" data-class="expand" href="#"><i class='fa fa-bars fa-2x'></i>
</a></div>
<div class='logo'><a href="/">Ryan McGeary</a></div>
</header>
<section id='sidebar'>
<div class='container'>
<aside>
<h2 id="about-me">About Me</h2>

<p><a href="/">Ryan McGeary</a> is a software consultant, business starter,
rubyist, web guru, CrossFit enthusiast, and amateur
triathlete. Ryan owns <a href="http://mcgearygroup.com">McGeary Consulting
Group</a> and is the founder of
<a href="http://busyconf.com">BusyConf</a> and
<a href="http://chargestack.com">ChargeStack</a>. He lives near Boulder,
Colorado.</p>

<p><a href="https://twitter.com/intent/follow?screen_name=rmm5t">Follow me</a>, <a href="https://www.linkedin.com/in/ryanmcgeary">view my
résumé</a>, or
<a href="http://feeds.feedburner.com/ryanmcgeary">subscribe</a>.</p>


</aside>
<nav>
<h2><a href="/blog/">Recent</a></h2>
<ul class='list-unstyled'>
<li>
<a href="/2015/05/22/rejuvenating-my-piece-of-the-interwebs/">Rejuvenating My Piece of the Interwebs</a>
</li>
<li>
<a href="/2015/05/12/cloud-services-you-should-be-using-to-build-your-startup/">Talk: Cloud Services You Should Be Using To Build Your Startup</a>
</li>
<li>
<a href="/2014/08/20/html5-autocomplete-cheatsheet/">HTML5 Autocomplete Cheatsheet</a>
</li>
<li>
<a href="/2014/02/19/busyconf-1-million-cups-st-pete/">Talk: The BusyConf Story</a>
</li>
<li>
<a href="/2013/12/20/interview-with-eventtech-podcast/">Interview with #EventTech Podcast</a>
</li>
<li>
<a href="/2013/12/19/continuous-integration-deployment-middleman-codeship-github-pages/">Continuous Integration and Deployment with Middleman, Codeship, and GitHub Pages</a>
</li>
</ul>
<h2><a href="/blog/">Topics</a></h2>
<ul class='list-unstyled'>
<li>
<a href="/screencasts/">screencasts</a>
</li>
<li>
<a href="/talks/">talks</a>
</li>
<li>
<a href="/programming/">programming</a>
</li>
<li>
<a href="/business/">business</a>
</li>
<li>
<a href="/tech/">tech</a>
</li>
<li>
<a href="/interviews/">interviews</a>
</li>
<li>
<a href="/podcasts/">podcasts</a>
</li>
<li>
<a href="/personal/">personal</a>
</li>
</ul>
<h2><a href="/blog/">Archive</a></h2>
<ul class='list-unstyled'>
<li>
<a href="/2015/">2015</a>
</li>
<li>
<a href="/2014/">2014</a>
</li>
<li>
<a href="/2013/">2013</a>
</li>
<li>
<a href="/2012/">2012</a>
</li>
<li>
<a href="/2011/">2011</a>
</li>
<li>
<a href="/2010/">2010</a>
</li>
<li>
<a href="/2008/">2008</a>
</li>
</ul>
</nav>
<aside>
<h2><a href="http://feeds.feedburner.com/ryanmcgeary">RSS</a></h2>
</aside>
<footer>
Copyright &copy; 2015
<br>
Ryan McGeary
<br>
All rights reserved.
</footer>
</div>
<footer></footer>
</section>
<div class='content-wrapper'>
<section id='content'>
<div class='container'><article>
<h1>
MongoDB Schema Design at BusyConf
<small class='text-nowrap'>Jun  5, 2012</small>
</h1>


<p>This post is in response to the
<a href="http://blog.10gen.com/post/23237721457/blogging-contest-mongodb-schema-design">10gen MongoDB Schema Design Contest</a>. It
was also extracted from
<a href="http://ryan.mcgeary.org/talks/2010/12/14/busyconf-mongodc/">talks</a> that I’ve
given on the subject.</p>

<h2 id="obligatory-plug">Obligatory Plug</h2>

<p><a href="http://busyconf.com/">BusyConf</a> currently handles 4 major pieces of conference planning –
it collects speaker proposals, allows the review committee to rate speaker
proposals, builds an offline-enabled and archived HTML5 schedule (iPhone,
Android, iPad, Desktop), and handles attendee ticket registration including
payments, refunds, etc.</p>

<p>We attend conferences, and as attendees, the schedule at the conference is often
lacking.  It’s poorly organized, lacks information, and requires Internet
access. This makes it hard as an attendee to choose the talks that you want to go
to. <a href="http://busyconf.com/">BusyConf</a> is an attempt to solve that problem while also making
it easier for conference organizers to run a conference.  We handle the calls
for proposal, we allow organizers to rate proposals, we give them an interface
to turn activities into a schedule, and we publish that schedule in many
formats. We also handle ticket registration and credit card payments.</p>

<h2 id="why-mongodb">Why MongoDB?</h2>

<p><a href="http://www.mongodb.org/">MongoDB</a> was a huge win for us while designing our application. The
goal of this post is to explain why we chose MongoDB, how we use it at BusyConf,
what design decisions we considered, and what the alternatives might have been.</p>

<p>Here’s a common myth that I’ve heard before: <em>“MongoDB design is easy because
its schema-less.”</em> I disagree with this. It’s true that a thoughtful design will
yield a longer term gain in easier development, but it can be tricky to conjure
up with such a design. I find it much easier to get a relational design right
the first time, but the costs of maintaining a relational design can sometimes
be higher.</p>

<blockquote class="blockquote-reverse">
  <p>“You could use a relational database for that! Why use a document store?”</p>
</blockquote>

<p>MongoDB’s speed and scalability are wins, but for us, it’s not as important as
the win we get from rapid development. Rapid development comes from the ability
to represent richer data models that more closely match the business problems
and the patterns of access.</p>

<p>Many people say things like: <em>“You could use a relational database for that! Why
use a document store?”</em>  MongoDB has become our default database for greenfield
development. We now make ourselves justify the use of relational. Instead of,
<em>“Why MongoDB?”</em> we ask, <strong><em>“Why NOT MongoDB?”</em></strong></p>

<h2 id="the-logical-model">The Logical Model</h2>

<p>This post only covers the design of our database that represents a conference
schedule.  The data model that represents a conference schedule is roughly a
tree – very nested. Imagine a typical conference or convention that you
attended in the past. Events have days, days have tracks, tracks have time
slots, time slots have activities, and activities have speakers. In addition,
days can also have global time slots (like Lunches, Breaks, and Keynotes).</p>

<p><img alt="BusyConf Logical Model" title="BusyConf Logical Model" src="/2012/06/05/mongodb-schema-design-at-busyconf/logical-model.png" /></p>

<p>When we access our data for rendering a schedule, we need to pull all of this at
once, because we want a seamless, cached experience for the conference attendee.</p>

<h2 id="the-relational-option">The Relational Option</h2>

<p>What might the above logical model look like in a relational database?  The nice
thing about a relational model is that they are fairly easy to design.  This is
how we might have modeled our data given a relational database.</p>

<p><img alt="BusyConf Relational Model" title="BusyConf Relational Model" src="/2012/06/05/mongodb-schema-design-at-busyconf/relational-model.png" /></p>

<blockquote class="blockquote-reverse">
  <p>What kind of queries would be required to pull all the data from this design?</p>
</blockquote>

<p>It looks pretty straight forward until you imagine having to pull all this data
at once to render a full schedule. What kind of query or queries would be
required from a relational database? Would you use one big nasty join, or lots
of individual queries? Neither seem like a great option.</p>

<p>To add to the problem, little things like the position of tracks are not easily
represented.  Neither is the potential explosion of meta data that could come
from each object.</p>

<h2 id="first-attempt-with-mongodb">First Attempt with MongoDB</h2>

<p>Representing our logical model directly within MongoDB was our first instinct,
BUT putting this into practice actually led us down a road of unnecessary
complexities:</p>

<p><img alt="BusyConf MongoDB Model - First Attempt" title="BusyConf MongoDB Model - First Attempt" src="/2012/06/05/mongodb-schema-design-at-busyconf/mongodb-option1.png" /></p>

<blockquote class="blockquote-reverse">
  <p>This first attempt was a mistake.</p>
</blockquote>

<p>While we solved the problem of quickly accessing the entire event, we no longer
have an easy way of accessing an individual activity or speaker.  We can quickly
see the complexities in the drawing above.</p>

<h2 id="current-design-with-mongodb">Current Design with MongoDB</h2>

<p>We iterated on the design many times, but in the end, we took a fairly unique
approach.</p>

<p><img alt="BusyConf MongoDB Model - Current Design" title="BusyConf MongoDB Model - Current Design" src="/2012/06/05/mongodb-schema-design-at-busyconf/mongodb-option2.png" /></p>

<p>Instead of one collection, we broke out Activities and Speakers.<sup id="fnref:embed"><a href="#fn:embed" class="footnote">1</a></sup> This
matched our patterns of access much better. Instead of deeply nesting every
object, we chose to embed arrays of days, tracks, and time slots immediately
under the event document.</p>

<p>Each object has a unique ID. Everything is more easily addressable, because we
have less nesting. The logical model is represented with pointers from one
nested document to another. Of course, we don’t actually see our logical model
until we piece it together on the client side, but that is okay because we don’t
need the full logical model until until we put the leg work in to render the
schedules in the browser.</p>

<h2 id="conclusion">Conclusion</h2>

<p>MongoDB can be somewhat tricky when it comes to the up front design, but if done
right, it has some great benefits both in defining and matching your unique
access patterns along with fairly decent long-term maintenance benefits.</p>

<div class="footnotes">
  <ol>
    <li id="fn:embed">
      <p>Later, we decided to embed Speakers under Activities to improve our patterns of access, but ironically, we plan to switch Speakers back out to their own collection again to provide cleaner normalization. <a href="#fnref:embed" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>


<hr>
<p>
<em>
Please
<a href="https://twitter.com/intent/tweet?hashtags=programming%2C+business&amp;size=large&amp;text=MongoDB+Schema+Design+at+BusyConf&amp;url=http%3A%2F%2Fryan.mcgeary.org%2F2012%2F06%2F05%2Fmongodb-schema-design-at-busyconf%2F&amp;via=rmm5t">share</a>, <a href="https://twitter.com/intent/tweet?in_reply_to=210128328001196032">reply to comment</a>, or <a href="https://twitter.com/intent/retweet?tweet_id=210128328001196032">retweet</a>.
Also
<a href="https://twitter.com/intent/follow?screen_name=rmm5t">follow me</a>
for more.
</em>
</p>
<hr>
<a class="twitter-share-button" data-url="http://ryan.mcgeary.org/2012/06/05/mongodb-schema-design-at-busyconf/" data-text="MongoDB Schema Design at BusyConf" data-via="rmm5t" data-size="large" data-hashtags="programming, business" href="https://twitter.com/share">Tweet</a>
<a class="twitter-follow-button" data-show-count="true" data-size="large" href="https://twitter.com/rmm5t">Follow @rmm5t</a>
<br>
<div class="g-plus" data-action="share" data-annotation="bubble" data-href="http://ryan.mcgeary.org/2012/06/05/mongodb-schema-design-at-busyconf/" data-height="28"></div>


</article>
</div>
</section>
</div>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js" type="text/javascript"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js" type="text/javascript"></script>
<script src="/javascripts/all.js" type="text/javascript"></script>
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-604149-3', 'auto');
  ga('send', 'pageview');
</script>
<script src="https://apis.google.com/js/platform.js" type="text/javascript" async="true" defer="defer"></script>
</body>
</html>
