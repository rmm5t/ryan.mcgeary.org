<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<meta name="generator" content="Middleman 3.4.1; Middleman::Blog 3.5.3; Middleman::Syntax 2.1.0; Ruby 2.3.8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="author" content="Ryan McGeary" />
<meta name="google-site-verification" content="_8VeV30p3ACH5-9hJ4EtaYoeQ04dFAOQ_bRPVjxK-Ss" />
<meta name="description" content="UPDATE: Since writing this post, I have since switched to using rbenv for my ruby version management. I no longer use RVM. Rbenv lends itself nicely to the workflow described here, and some of the ..." />
<meta name="og:title" content="“Vendor Everything” Still Applies" />
<meta name="og:description" content="UPDATE: Since writing this post, I have since switched to using rbenv for my ruby version management. I no longer use RVM. Rbenv lends itself nicely to the workflow described here, and some of the ..." />
<meta name="og:site_name" content="Ryan McGeary" />
<meta name="og:image" content="http://ryan.mcgeary.org/images/ryan.mcgeary.jpg" />
<meta name="twitter:image" content="http://ryan.mcgeary.org/images/ryan.mcgeary.jpg" />
<meta name="twitter:site" content="@rmm5t" />
<meta name="twitter:creator" content="@rmm5t" />
<meta name="og:type" content="article" />
<meta name="article:published_time" content="2011-02-08T17:00:00-07:00" />
<meta name="article:tag" content="programming" />
<meta name="keywords" content="programming" />
<meta name="twitter:card" content="summary_large_image" />
<title>“Vendor Everything” Still Applies - Ryan McGeary</title>
<link rel="alternate" type="application/atom+xml" title="Ryan McGeary Blog Posts" href="http://feeds.feedburner.com/ryanmcgeary" />
<link type="image/x-icon" href="/favicon.ico" rel="icon" />
<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet" />
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" />
<link href="/stylesheets/all.css" rel="stylesheet" />
<!--[if lt IE 9]>
<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv-printshiv.min.js"></script>
<![endif]-->
</head>
<body class='x2011 x2011_02 x2011_02_09 x2011_02_09_vendor-everything-still-applies x2011_02_09_vendor-everything-still-applies_index'>
<div id='background'></div>
<div id='photo'><img src="/images/ryan.mcgeary.png" alt="Ryan.mcgeary" /></div>
<header data-offset-top='15' data-spy='affix' id='masthead' role='banner'>
<p class='sr-only'><a href="/" rel="home">Ryan McGeary</a></p>
<div class='sm-controls'>
<a href="#" class="btn" data-toggle="class" data-target="#sidebar, #background, #photo, #masthead .logo" data-class="expand"><i class='fa fa-bars fa-2x'></i>
</a></div>
<div class='logo'><a href="/">Ryan McGeary</a></div>
</header>
<section id='sidebar'>
<div class='container'>
<aside>
<h2 id="about-me">About Me</h2>

<p><a href="/">Ryan McGeary</a> is a software developer and consultant, business
starter, rubyist (at heart), polyglot (in practice), web guru,
father, CrossFit nerd, and former amateur triathlete and
collegiate swimmer. Ryan owns <a href="http://mcgearygroup.com">McGeary Consulting Group</a> and is the
founder of <a href="http://busyconf.com">BusyConf</a> and <a href="http://chargestack.com">ChargeStack</a>. He lives near Boulder,
Colorado.</p>

<p><a href="https://twitter.com/intent/follow?screen_name=rmm5t">Follow me</a>, <a href="https://www.linkedin.com/in/ryanmcgeary">view my
résumé</a>,
<a href="http://feeds.feedburner.com/ryanmcgeary">subscribe</a> or <a href="http://mcgearygroup.com/">contact
me</a>.</p>


</aside>
<nav>
<h2><a href="/blog/">Recent</a></h2>
<ul class='list-unstyled'>
<li>
<a href="/2016/02/05/proper-counter-cache-migrations-in-rails/">Proper Counter Cache Migrations in Rails</a>
</li>
<li>
<a href="/2015/05/26/reverse-engineering-american-express-usb-webkey/">Reverse Engineering an American Express USB WebKey</a>
</li>
<li>
<a href="/2015/05/22/rejuvenating-my-piece-of-the-interwebs/">Rejuvenating My Piece of the Interwebs</a>
</li>
<li>
<a href="/2015/05/12/cloud-services-you-should-be-using-to-build-your-startup/">Talk: Cloud Services You Should Be Using To Build Your Startup</a>
</li>
<li>
<a href="/2014/08/20/html5-autocomplete-cheatsheet/">HTML5 Autocomplete Cheatsheet</a>
</li>
<li>
<a href="/2014/02/19/busyconf-1-million-cups-st-pete/">Talk: The BusyConf Story</a>
</li>
</ul>
<h2><a href="/blog/">Topics</a></h2>
<ul class='list-unstyled'>
<li>
<a href="/programming/">programming</a>
</li>
<li>
<a href="/talks/">talks</a>
</li>
<li>
<a href="/interviews/">interviews</a>
</li>
<li>
<a href="/podcasts/">podcasts</a>
</li>
<li>
<a href="/business/">business</a>
</li>
<li>
<a href="/tech/">tech</a>
</li>
<li>
<a href="/screencasts/">screencasts</a>
</li>
<li>
<a href="/personal/">personal</a>
</li>
</ul>
<h2><a href="/blog/">Archive</a></h2>
<ul class='list-unstyled'>
<li>
<a href="/2016/">2016</a>
</li>
<li>
<a href="/2015/">2015</a>
</li>
<li>
<a href="/2014/">2014</a>
</li>
<li>
<a href="/2013/">2013</a>
</li>
<li>
<a href="/2012/">2012</a>
</li>
<li>
<a href="/2011/">2011</a>
</li>
<li>
<a href="/2010/">2010</a>
</li>
<li>
<a href="/2008/">2008</a>
</li>
</ul>
</nav>
<aside>
<h2><a href="http://feeds.feedburner.com/ryanmcgeary">RSS</a></h2>
</aside>
<footer>
Copyright &copy; 1978-2019
<br>
Ryan McGeary
<br>
All rights reserved.
</footer>
</div>
<footer></footer>
</section>
<div class='content-wrapper'>
<section id='content'>
<div class='container'><article>
<h1>
“Vendor Everything” Still Applies
<small class='text-nowrap'>Feb  9, 2011</small>
</h1>


<p><strong>UPDATE:</strong> Since writing this post, I have since switched to using
<a href="https://github.com/sstephenson/rbenv">rbenv</a> for my ruby version management.  I
no longer use RVM. Rbenv lends itself nicely to the workflow described here, and
some of the workflow below has been modified to reflect that. RVM instructions
are still included though.</p>

<p>That’s right. The title is a homage to the (now
<a href="http://twitter.com/defunkt"><em>defunkt</em></a>)
<a href="http://errtheblog.com/posts/50-vendor-everything">err the blog</a>, and keeping
your application dependencies with your application is <em>still</em> a very good
thing.</p>

<p>As a consultant, I jump between a lot of different Ruby projects from day to
day.  Some are my own; some are owned by others. Some are greenfield; some are
legacy. Sometimes, I’m the sole developer; sometimes, I’m working with a team.</p>

<p>There’s nothing more frustrating than jumping on an existing project only to
fall into dependency hell when your first goal is just a passing test suite.
Dependencies can be quite difficult to manage, and fortunately, we have some
great tools like <a href="http://gembundler.com/">Bundler</a> and
<a href="https://github.com/sstephenson/rbenv">rbenv</a> to help out. The problem, however,
is that we as a community have not fully standardized on the best set of
conventions surrounding these tools.</p>

<p><em>Disclaimer: The set of conventions described here apply to Ruby applications
only.  This includes Rails apps, Sinatra apps, or other Ruby applications that
aren’t deployed in the form of a gem.</em></p>

<h2 id="do-check-your-ruby-version-into-version-control">Do Check Your <code>.ruby-version</code> into Version Control</h2>

<blockquote class="blockquote-reverse">
  <p>Your <code>.ruby-version</code> file is an important piece of documentation.</p>
</blockquote>

<p>For applications, your <code>.ruby-version</code> file is an important piece of
documentation.  I think this is the best way to communicate the Ruby version
dependency to other team members. This is especially true given that these
files at the root of your project will make rbenv or RVM automatically use
that version of Ruby when you’re in that project directory.</p>

<p>I recently inherited a project that had a test suite with very little coverage
and no documentation as to which version of Ruby was required. I could tell the
project wasn’t on Ruby 1.9 yet, so I guessed at Ruby 1.8.7. It wasn’t until much
later that I realized Ruby 1.8.6 was actually required.  For another legacy
project that I worked on, we guessed correctly at Ruby 1.8.7, but it wasn’t
until we went to deploy and took a look at the production environment that we
realized we should have been developing against Ruby Enterprise Edition (REE)
instead of MRI.</p>

<p><em><strong>Note</strong>: When this post was first written, I advocated checking in your
<code>.rvmrc</code> file, because at the time, that was the only way to specify your ruby
version. That was controversial, because an <code>.rvmrc</code> could potentially contain
personal preferences (that I didn’t think belonged in that file). Things have
changed, and <code>.ruby-version</code> is the way to go regardless of your chosen ruby
version manager.</em></p>

<h2 id="stop-using-rvm-gemsets-for-your-applications">Stop Using RVM Gemsets For Your Applications</h2>

<p>Please stop using RVM gemsets for your applications. Seriously. The original title
of this post was going to be, “RVM Gemsets are overrated,” but that seemed too
much like flamebait, and I didn’t want anyone to miscontrue my overall point.</p>

<p>RVM is absolutely one of the best things that has hit the Ruby community in
recent history, and <a href="http://rvm.beginrescueend.com/gemsets/basics/">RVM gemsets</a>
are a great tool. It’s just that I see too many applications rely on the use of
gemsets when it yields no added benefit.  I understand why people do it; they
don’t want to pollute their default gemset, but this reliance on gemsets for
applications is totally unnecessary.  It also seems to be a common point of
confusion amongst teams.</p>

<p>There is a better way, that still doesn’t pollute the default gemset, and it
includes a lesser known feature of Bundler.</p>

<h2 id="let-bundler-follow-the---path">Let Bundler Follow the <code>--path</code></h2>

<blockquote class="blockquote-reverse">
  <p>Bundler alleviates the need for different gemsets per project.</p>
</blockquote>

<p>It is possible to install application dependencies cleanly without relying on an
RVM gemset. I like to install all application dependencies into a gitignored
directory within the application itself.  This not only alleviates the need for
different gemsets per project, but it also gives us a quick and easy way to jump
into the source code of any one of our gem dependencies.  We can do this with
the <code>--path</code> option passed to
<a href="http://gembundler.com/bundle_install.html"><code>bundle install</code></a>.  Here’s the
convention I like to use:</p>

<pre class="highlight shell"><code>bundle install --path vendor
<span class="nb">echo</span> <span class="s1">'vendor/ruby'</span> &gt;&gt; .gitignore
</code></pre>

<p>After running this, all gems (and gems pulled directly from git repositories)
will be unpacked into the <code>vendor/ruby</code> directory of your project.  It’s a good
idea to ignore this directory from version control.</p>

<p>This one step removes the need to create a custom RVM gemset for any of your
applications, and it ensures that your default gemset is never polluted by
application dependencies. This way, Bundler completely isolates the gems from
the system, guaranteeing a clear set of dependencies.</p>

<h2 id="package-your-gems-in-vendorcache">Package Your Gems in <code>vendor/cache</code></h2>

<p>For applications, I cannot emphasize enough how beneficial it is to keep all of
your gem dependencies with your application.  I’m not just talking about a
<code>Gemfile</code> and <code>Gemfile.lock</code><sup id="fnref:gemfile-lock"><a href="#fn:gemfile-lock" class="footnote">1</a></sup>, but I’m also talking about the gems
themselves. Bundler allows you to save all of your gems in a <code>vendor/cache</code>
directory after running
<a href="http://gembundler.com/bundle_package.html"><code>bundle package</code></a>.  It ensures the
gems are available without having to sync with a gem server.</p>

<pre class="highlight shell"><code>bundle package
</code></pre>

<p>I’ve seen resistance to this practice, but the only arguments against it usually
refer to taking up too much space in version control. That argument is
poppycock. Storage is cheap. You’ll thank me later when your deployments run
smoothly, and when several years from now, an otherwise missing gem is at your
fingertips. Not to mention, having all your gems in <code>vendor/cache</code> makes <code>bundle
install</code> run faster both for new team members and in your continuous integration
environment. Deployment environments like <a href="http://heroku.com/">Heroku</a> really
benefit from this practice too.</p>

<h2 id="how-can-i-remember-all-of-this">How Can I Remember All of This?</h2>

<p>Here are some command line aliases that help me:</p>

<pre class="highlight shell"><code><span class="nb">alias </span><span class="nv">b</span><span class="o">=</span><span class="s2">"bundle"</span>
<span class="nb">alias </span><span class="nv">bi</span><span class="o">=</span><span class="s2">"b install --path vendor"</span>
<span class="nb">alias </span><span class="nv">bil</span><span class="o">=</span><span class="s2">"bi --local"</span>
<span class="nb">alias </span><span class="nv">bu</span><span class="o">=</span><span class="s2">"b update"</span>
<span class="nb">alias </span><span class="nv">be</span><span class="o">=</span><span class="s2">"b exec"</span>
<span class="nb">alias </span><span class="nv">binit</span><span class="o">=</span><span class="s2">"bi &amp;&amp; b package &amp;&amp; echo 'vendor/ruby' &gt;&gt; .gitignore"</span>
</code></pre>

<p>Any time I jump into a new project that already has a Gemfile, I merely need to
run <code>bi</code> and the gems are installed in an application specific location
(<code>vendor/ruby</code>) without the need for a custom RVM gemset.  Anytime I’m starting
a new project or trying to convert an old project to these new conventions, I
just run <code>binit</code>, which installs and packages the gems within the application
while also gitignoring the <code>vendor/ruby</code> directory.</p>

<h2 id="tldr">TL;DR</h2>

<ul>
  <li>Check your <code>.ruby-version</code> file into version control; it’s a form of documentation.</li>
  <li>Avoid RVM gemsets for your applications; Bundler solves the same problem in a better way (<code>bundle install --path vendor</code>).</li>
  <li>Keep a cache of your gem dependencies in version control using <code>bundle package</code>.</li>
  <li>This only applies to Ruby applications; gem development is a different beast.</li>
</ul>

<pre class="highlight shell"><code>bundle install --path vendor
bundle package
<span class="nb">echo</span> <span class="s1">'vendor/ruby'</span> &gt;&gt; .gitignore
</code></pre>
<div class="footnotes">
  <ol>
    <li id="fn:gemfile-lock">
      <p>By the way, for applications, please do <a href="http://yehudakatz.com/2010/12/16/clarifying-the-roles-of-the-gemspec-and-gemfile/">check your <code>Gemfile.lock</code> into version control</a>. For libraries/gems, please do not check it in, and please add <code>Gemfile.lock</code> to your <code>.gitignore</code> file for the project. <a href="#fnref:gemfile-lock" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>


<hr>
<p>
<em>
Please
<a href="https://twitter.com/intent/tweet?hashtags=programming&amp;size=large&amp;text=%E2%80%9CVendor+Everything%E2%80%9D+Still+Applies&amp;url=http%3A%2F%2Fryan.mcgeary.org%2F2011%2F02%2F09%2Fvendor-everything-still-applies%2F&amp;via=rmm5t">share</a>, <a href="https://twitter.com/intent/tweet?in_reply_to=35461919355707394">reply to comment</a>, or <a href="https://twitter.com/intent/retweet?tweet_id=35461919355707394">retweet</a>.
Also
<a href="https://twitter.com/intent/follow?screen_name=rmm5t">follow me</a>
for more.
</em>
</p>
<hr>
<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ryan.mcgeary.org/2011/02/09/vendor-everything-still-applies/" data-text="“Vendor Everything” Still Applies" data-via="rmm5t" data-size="large" data-hashtags="programming">Tweet</a>
<a href="https://twitter.com/rmm5t" class="twitter-follow-button" data-show-count="true" data-size="large">Follow @rmm5t</a>
<br>
<div class="g-plus" data-action="share" data-annotation="bubble" data-href="http://ryan.mcgeary.org/2011/02/09/vendor-everything-still-applies/" data-height="28"></div>


</article>
</div>
</section>
</div>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="/javascripts/all.js"></script>
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-604149-3', 'auto');
  ga('send', 'pageview');
</script>
<script src="https://apis.google.com/js/platform.js" async="true" defer="defer"></script>
</body>
</html>
